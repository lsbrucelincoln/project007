<div class="welcome admin_content_innerBox" style="height: 100%">
    <div class="admin_scrollBox">
        <div class="infoHeader">
            <div class="leftInfo"><span class="title">通知公告</span>
                <div class="scrollBox"><i class="flaticon-music"></i>这里可以插入下载超链接，不够显示，可以左右滚动播放。</div>
            </div>
            <a href="#/welcome.html" class="normalBtn"><i class="flaticon-location"></i><span>返回</span></a>
        </div>
        <div id="baiduMap">
            
        </div>
    </div>
</div>
<script src="http://api.map.baidu.com/api?v=2.0&ak=Ogc3s9tT2jSfg8GvYBScols0iyeSoUGG&callback=initialize"></script>
<script type="text/javascript">
// 获取危险源
$.when(getModels()).done(function(data){
    if(data.state == 0){
        console.log(data);
    }
})
function initialize() {
    $("#baiduMap").height($("#admin_content_table").height() - 30);
    $(window).bind('resize', function() {
        $("#baiduMap").height($("#admin_content_table").height() - 30);
    });
    var map = new BMap.Map("baiduMap"); // 创建地图实例  
    var point = new BMap.Point(121.556686, 29.880177); // 创建点坐标  
    map.centerAndZoom(point, 15); // 初始化地图，设置中心点坐标和地图级别  
    var top_left_control = new BMap.ScaleControl({
        anchor: BMAP_ANCHOR_TOP_LEFT
    }); // 左上角，添加比例尺
    var top_left_navigation = new BMap.NavigationControl(); //左上角，添加默认缩放平移控件
    
    map.addControl(top_left_control);
    map.addControl(top_left_navigation);

    var marker1 = new BMap.Marker(new BMap.Point(121.566686, 29.889177));
    map.addOverlay(marker1);
    marker1.addEventListener('click', function(e) {
        map.openInfoWindow(infoWindow1, marker1.getPosition());
    });
    var marker2 = new BMap.Marker(new BMap.Point(121.5606865, 29.870177));
    map.addOverlay(marker2);
    marker2.addEventListener('click', function(e) {
        map.openInfoWindow(infoWindow2, marker2.getPosition());
    });
    var marker3 = new BMap.Marker(new BMap.Point(121.5516869, 29.881));
    map.addOverlay(marker3);
    marker3.addEventListener('click', function(e) {
        map.openInfoWindow(infoWindow3, marker3.getPosition());
    });
    var marker4 = new BMap.Marker(new BMap.Point(121.549686, 29.88197));
    map.addOverlay(marker4);
    marker1.addEventListener('click', function(e) {
        map.openInfoWindow(infoWindow1, marker1.getPosition());
    });
    var marker5 = new BMap.Marker(new BMap.Point(121.5536865, 29.863177));
    map.addOverlay(marker5);
    marker2.addEventListener('click', function(e) {
        map.openInfoWindow(infoWindow2, marker2.getPosition());
    });
    var marker6 = new BMap.Marker(new BMap.Point(121.5586869, 29.871));
    map.addOverlay(marker6);
    marker3.addEventListener('click', function(e) {
        map.openInfoWindow(infoWindow3, marker3.getPosition());
    });


    var opts = {
        width: 220, // 信息窗口宽度    
        height: 60, // 信息窗口高度    
    };
    var html = '<table>' +
        '<tbody>' +
        '<tr>' +
        '<td>隐患编号：</td>' +
        '<td>NBYH010220160810001</td>' +
        '</tr>' +
        '<tr>' +
        '<td>等级：</td>' +
        '<td>2</td>' +
        '</tr>' +
        '<tr>' +
        '<td>登记时间：</td>' +
        '<td>2016-08-10</td>' +
        '</tr>' +
        '</tbody>' +
        '</table>';
    var infoWindow1 = new BMap.InfoWindow(html, opts);
    var infoWindow2 = new BMap.InfoWindow(html, opts);
    var infoWindow3 = new BMap.InfoWindow(html, opts);

    map.openInfoWindow(infoWindow1, new BMap.Point(121.5606865, 29.870177));

    // 添加自定义控件： 右上角的4个选项
    function selectBoxControl(){    
        // 设置默认停靠位置和偏移量  
        this.defaultAnchor = BMAP_ANCHOR_TOP_RIGHT;    
        this.defaultOffset = new BMap.Size(10, 10);    
    }    
    selectBoxControl.prototype = new BMap.Control();
    selectBoxControl.prototype.initialize = function(map){
        var _selectBox = $('<div class="map_selectBox">'+
                            '<div data-name="Dangerous">重大危险源</div>'+
                            '<div data-name="Company">注册企业</div>'+
                            '<div data-name="Recheck">隐患问题</div>'+
                            '<div data-name="Task">评估任务</div>'+
                        '</div>');
        _selectBox.find('[data-name]').bind('click',function(){
            var name = $(this).attr("data-name");
            if(name == "Dangerous"){

            }
            else if (name == "Company"){

            }
            else if (name == "Recheck"){
                
            }
            else{

            }
        })
        map.getContainer().appendChild(_selectBox[0]);
    }
    var mySelectBoxCtrl = new selectBoxControl();
    map.addControl(mySelectBoxCtrl);
}




function getModels(){
    var ajax = $.ajax({
                    url: "/models",
                    type: "POST",
                    data: "models[0].name=Dangerous&models[0].name=Recheck&models[0].name=Company&models[0].name=Task"
                });
    return ajax;
}
</script>














