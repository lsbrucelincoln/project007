<div class="addAssessment admin_content_innerBox dataManagement" id="dataManagementBody">
    <div class="minibar"><i class="flaticon-arrows-4"></i><span>当前位置：首页 > 评估标准管理 > <span class="nowPlace">数据管理</span></span>
    </div>
    <div class="admin_scrollBox">
        <div class="contentBody">
            <div class="dataPage">
                <div class="inputShort assessType"><span>选择企业类型:</span>
                    <div class="admin_ui_select" style="width: 140px;">
                        <select>
                            <option value="">日常评估检查</option>
                        </select>
                    </div>
                    <input type="checkBox" id="canUse">
                    <label for="canUse">只看有效</label>
                </div>
                <div class="dataOutBtn normalBtn">导出数据</div>
                <div class="dataOutBtn normalBtn">导入数据</div>
                <div class="assess2Body">
                    <div class="ztrbox">
                        <div class="ztreeBox ztree">
                        </div>
                        <i class="flaticon-add"></i>
                        <i class="flaticon-cancel"></i></div>
                    <div class="tableBox">
                        <table>
                            <tr>
                                <th width="240px">内容</th>
                                <th style="width: 40px;">等级</th>
                                <th style="width: 60px;">强制执行</th>
                                <th style="width: 100px;">更新时间<i class="flaticon-sort"></i></th>
                                <th style="width: 100px;">当前状态</th>
                                <th style="width: 80px;">操作</th>
                            </tr>
                            <tr>
                                <td style="text-align:left">港口危险货物作业附证（港口经营人、经营范围、附证事项、有效期限）</td>
                                <td>1</td>
                                <td>是</td>
                                <td>06/01 20:00</td>
                                <td>正常</td>
                                <td><a href="">查看</a></td>
                            </tr>
                            <tr>
                                <td style="text-align:left">港口经营许可证（港口经营人、经营范围、附证事项、有效期限）</td>
                                <td>1</td>
                                <td>是</td>
                                <td>06/01 20:00</td>
                                <td>正常</td>
                                <td><a href="">查看</a></td>
                            </tr>
                            <tr>
                                <td style="text-align:left">安全生产委员会健全，职位分工明确</td>
                                <td>1</td>
                                <td></td>
                                <td>06/01 20:00</td>
                                <td>失效</td>
                                <td><a href="">删除</a></td>
                            </tr>
                            <tr>
                                <td style="text-align:left">安全生产管理机构健全，有专职管理人员</td>
                                <td>2</td>
                                <td>是</td>
                                <td>06/01 20:00</td>
                                <td>正常</td>
                                <td><a href="">查看</a></td>
                            </tr>
                            <tr>
                                <td style="text-align:left">安全生产管理机构工作制度健全，流程明确</td>
                                <td>1</td>
                                <td>是</td>
                                <td>06/01 20:00</td>
                                <td>正常</td>
                                <td><a href="">查看</a></td>
                            </tr>
                        </table>
                        <div class="bottom-search">
                            <div class="addBtn normalBtn" style="margin-top:15px">新增</div>
                            <div class="allSelectBtn normalBtn" style="margin-top:15px">全选</div>
                            <div class="urgeBtn normalBtn" style="margin-top:15px">删除</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
$(document).ready(function() {
    TablePage("table", 10);
    $("#processingBtn").on('click', function(event) {
        event.preventDefault();
        $(".processingTable").show();
        $(".finishedTable").hide();
        $(this).addClass('chosen');
        $("#finishedBtn").removeClass('chosen');
    });
    $("#finishedBtn").on('click', function(event) {
        event.preventDefault();
        $(".processingTable").hide();
        $(".finishedTable").show();
        $(this).addClass('chosen');
        $("#processingBtn").removeClass('chosen');
    });
    $(".rightBox").on('click', "p", function(event) {
        $(".leftBox").append($(this));
    });
    $(".leftBox").on('click', "p", function(event) {
        $(".rightBox").append($(this));
    });

    function getZTreeData() {
        var ajax = $.ajax({
            url: "../source/JSON/get_org.json"
        });
        return ajax;
    }
    var ztreeSetting = {
        async: {
            enable: false
        },
        data: {
            key: {
                name: "name",
                children: "data"
            }
        },
        view :{
        },
        edit:{
            enable:true
        },
        callback: {
            onClick: function(event, treeId, treeNode, clickFlag) {

            }
        }
    };
    $.when(getZTreeData()).done(function(data) {
        $.fn.zTree.init($(".ztreeBox"), ztreeSetting, data.org);
    });
            var vm = new Vue({
            el: "#dataManagementBody",
            data: {
                tasks: [],
                companyList: [],
                companyName: "",
                createTimeList: [],
                createTime: "",
                risks: {},
            },
            methods: {
                taskGetDetail: function(data) {
                    var companyList = [];
                    var timeList = [];
                    for (var i = 0; i < data.length; i++) {
                        data[i].time = vm.stamp2time(data[i].in_time);
                        data[i].createTime = data[i].time.split(" ")[0];
                        companyList.push(data[i].company.name)
                        timeList.push(data[i].createTime)
                    }
                    vm.tasks = data.reverse();
                    vm.companyList = vm.unique(companyList);
                    vm.createTimeList = vm.unique(timeList);
                },
                stamp2time: function(stamp) {
                    var time = new Date(stamp);
                    var year = time.getFullYear();
                    var month = time.getMonth() - 0 + 1;
                    var hours = time.getHours();
                    var minutes = time.getMinutes();
                    month = month < 10 ? "0" + month : month;
                    var day = time.getDate();
                    day = day < 10 ? "0" + day : day;
                    hours=hours<10?"0"+hours:hours;
                    minutes=minutes<10?"0"+minutes:minutes;
                    var timeString = '';
                    return month + "/" + day + " " + hours + ":" + minutes;
                },
                dayPeriodCompute:function(startTime,endTime){
                    var nowTime=new Date(startTime);
                    var theTime=new Date(endTime);
                    return theTime.getDate()-nowTime.getDate();
                },
            },
            created: function() {
                var self = this;
                var id = localStorage.getItem("id");
                $.post('/model', {
                    name: "SafeRule",
                    rows: 0
                }, function(data, textStatus, xhr) {
                    console.log(data);
                    if (data.state == 0) {
                        vm.taskGetDetail(data.data)
                    }
                });
            },
            ready: function() {

            }
        })
});
</script>
